<html>
<head>
<style>
#success {
  color: green;
  display: none;
}

#editor {
  width: 100%;
  height: 500px;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js"></script>
<script type="text/javascript">
  var editor;

  function loadConfig(id) {
      $.getJSON('/config/' + id, function(config) {
        $('#url').val(config.pageUrl);
        $('#contentType').val(config.contentType);
        editor.setValue(config.script);
      });
  }

  $(document).ready(function() {
      editor = ace.edit("editor");
      editor.setTheme("ace/theme/tomorrow_night");
      editor.getSession().setMode("ace/mode/javascript");

      loadConfig($('#id').val());

      $('#configurator').on('submit', function(e) {
        e.preventDefault();

        var id = $('#id').val();
        var url = $('#url').val();
        var contentType = $('#contentType').val();
        var code = editor.getValue();

        var json = {pageUrl: url, script: code, contentType: contentType };

        $.ajax({
          type: 'PUT',
          dataType: 'json',
          contentType: 'application/json; charset=utf-8',
          url: '/config/' + id,
          data: JSON.stringify(json),
          success: function() {
            $('#success').show();
            setTimeout(function() {
              $('#success').hide();
            }, 1000);
          }
        });
      });

      $('#loadConfig').on('click', function(e) {
        e.preventDefault();

        var id = $('#id').val();
        loadConfig(id);
      });
  });
</script>
</head>
<body>
<form id="configurator">
  <input type="text" id="url" placeholder="url" /><br/>
  <input type="text" id="contentType" placeholder="contentType"/><br/>
  <input type="text" id="id" value="1"/><br/>
  <div id="editor"></div>
  <input type="button" id="loadConfig" value="Load"/>
  <input type="submit" id="submit" value="Save"/>
  <span id="success">âœ“</span>
</form>
</body>
</html>
